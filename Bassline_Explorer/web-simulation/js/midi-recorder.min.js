function MIDIXMLRecorder(){this.isrecording=false;this.tempo=500000;this.trackname="Bassline Explorer Clip";this.lastnotes=[];this.ticks=0;this.midixmlheader='<?xml version="1.0"?><!DOCTYPE MIDIFile SYSTEM "http://www.musicxml.org/dtds/midixml.dtd"><MIDIFile><Format>1</Format><TrackCount>2</TrackCount><TicksPerBeat>8</TicksPerBeat><TimestampType>Absolute</TimestampType>';this.midixmltrk0='<Track Number="0"><Event><Absolute>0</Absolute><TimeSignature Numerator="4" LogDenominator="2" MIDIClocksPerMetronomeClick="24" ThirtySecondsPer24Clocks="8" CopyrightNotice="toneburst 2016"/></Event><Event><Absolute>0</Absolute><SetTempo Value="'+this.tempo+'"/></Event><Event><Absolute>0</Absolute><EndOfTrack/></Event></Track>';this.midixmltrk1=null;this.midixmlclose="</MIDIFile>";this.midixml=null}MicroEvent.mixin(MIDIXMLRecorder);MIDIXMLRecorder.prototype.settempo=function(a){this.tempo=(60/a)*1000000;this.midixmltrk0='<Track Number="0"><Event><Absolute>0</Absolute><TimeSignature Numerator="4" LogDenominator="2" MIDIClocksPerMetronomeClick="24" ThirtySecondsPer24Clocks="8"/></Event><Event><Absolute>0</Absolute><SetTempo Value="'+this.tempo+'"/></Event><Event><Absolute>0</Absolute><EndOfTrack/></Event></Track>'};MIDIXMLRecorder.prototype.settrackname=function(a){this.trackname=a};MIDIXMLRecorder.prototype.startrecording=function(){this.midixmltrk1='<Track Number="1"><Event><Absolute>0</Absolute><TrackName>'+this.trackname+"</TrackName></Event>";if(!this.isrecording){this.isrecording=true;this.ticks=0}};MIDIXMLRecorder.prototype.updateticks=function(){this.ticks++};MIDIXMLRecorder.prototype.recordnote=function(f,e,a,d){if(this.isrecording){var c=(f==="NoteOn")?d:0;var b="<Event>";b+="<Absolute>"+this.ticks+"</Absolute>";b+="<NoteOn ";b+='Channel="1" ';b+='Note="'+a+'" ';b+='Velocity="'+c+'"/>';b+="</Event>";this.midixmltrk1+=b;if(f=="NoteOn"){this.lastnotes.push(a);if(this.lastnotes.length>1){this.lastnotes.shift()}}}};MIDIXMLRecorder.prototype.stoprecording=function(){if(this.isrecording){this.isrecording=false;if(this.lastnotes.length>0){for(var a=0;a<this.lastnotes.length;a++){this.midixmltrk1+="<Event><Absolute>"+this.ticks+'</Absolute><NoteOn Channel="1" Note="'+this.lastnotes[a]+'" Velocity="0"/></Event>'}}this.midixmltrk1+="<Event><Absolute>"+this.ticks+"</Absolute><EndOfTrack/></Event>";this.midixmltrk1+="</Track>";this.midixml=this.midixmlheader+this.midixmltrk0+this.midixmltrk1+this.midixmlclose}};MIDIXMLRecorder.prototype.getmidixml=function(){return(this.midixml)?this.midixml:"No MIDIXML string to return. You must call this method After 'stoprecording' method."};