function TBMWMIDIio(){this.uicontainer=null;this.containerclass="midiui";this.idprefix="tbwm-io";this.outputselectid=this.idprefix+"-outputdevice";this.channelselectid=this.idprefix+"-channel";this.testoutputbutton=this.idprefix+"-testoutput";this.havemidi=false;this.havemidiin=false;this.havemidiout=false;this.havecontainer=false;this.midiaccess={};this.outputs={};this.inputs={};this.midiout={};this.midiin={};this.midichannel=1}MicroEvent.mixin(TBMWMIDIio);TBMWMIDIio.prototype.errordomelement=function(){var a="Error: Container element not found. You need to specify ID of an existing element (with or without leading '#') when initialising this instance or calling this method";console.log(a);return a};TBMWMIDIio.prototype.createlabel=function(c,b){var a=document.createElement("label");a.setAttribute("for",c);a.innerHTML=b;return a};TBMWMIDIio.prototype.errornomidi=function(b){this.havemidi=false;var a=b;console.log(a)};TBMWMIDIio.prototype.errornooutputdevice=function(){this.havemidiout=false;var a="Error: No MIDI output device is accessible.";console.log(a)};TBMWMIDIio.prototype.errornoinputdevice=function(){this.havemidi=false;var a="Error: No MIDI input device is accessible.";console.log(a)};TBMWMIDIio.prototype.channelmessage=function(c,a){var b={noteoff:8,noteon:9,controlchange:11,channelmode:11,programchange:12,channelaftertouch:13,pitchbend:14};if(!b[c]){console.log("Error: MIDI Channel message not found")}else{return(b[c]<<4)+(a-1)}};TBMWMIDIio.prototype.systemmessage=function(b){var a={sysex:240,timecode:241,songposition:242,songselect:243,tuningrequest:246,sysexend:247,clock:248,start:250,"continue":251,stop:252,activesensing:254,reset:255,};if(!a[b]){console.log("Error: MIDI System message not found")}else{return(a[b]<<4)+(ch-1)}};TBMWMIDIio.prototype.time=function(b){var a=window.performance.now();if(b){return a+b}else{return a}};TBMWMIDIio.prototype.init=function(c){if(c){this.uicontainer=document.getElementById(c.replace("#",""));if(!this.uicontainer){return this.errordomelement()}}else{return this.errordomelement()}this.havecontainer=true;this.uicontainer.classList.add(this.containerclass);var b=this;navigator.requestMIDIAccess().then(d,a);function d(e){b.havemidi=true;b.midiaccess=e;b.outputs=b.midiaccess.outputs;if(b.outputs.size>0){b.midiout=b.outputs.values().next().value;b.midiout.open();b.havemidiout=true}else{b.errornooutputdevice();b.havemidiout=false}console.log("MIDI system success!");b.trigger("midistatus","success")}function a(e){b.havemidi=false;b.havemidiin=false;b.havemidiout=false;console.log("Uh-oh! Something went wrong! Error code: "+e.code);b.trigger("midistatus","fail")}};TBMWMIDIio.prototype.setoutputdevice=function(a){if(this.havemidiout){this.midiout.close();this.midiout=this.outputs.get(a);this.midiout.open()}else{this.errornooutputdevice();return}};TBMWMIDIio.prototype.addoutputselect=function(){if(this.havemidi&&this.havemidiout){var b=this.createlabel(this.outputselectid,"Select MIDI Output Device");var c=document.createElement("select");c.setAttribute("id",this.outputselectid);this.outputs.forEach(function(d){var e=document.createElement("option");e.text=d.name;e.value=d.id;c.add(e)});this.uicontainer.appendChild(b);this.uicontainer.appendChild(c);var a=this;c.addEventListener("change",function(){a.setoutputdevice(this.value)})}else{this.errornooutputdevice()}};TBMWMIDIio.prototype.setoutmidichannel=function(a){this.midichannel=parseInt(a)};TBMWMIDIio.prototype.addoutchannelselect=function(){if(this.havemidi&&this.havemidiout){var b=this.createlabel(this.channelselectid,"Select MIDI Channel");var e=document.createElement("select");e.setAttribute("id",this.channelselectid);for(var d=1;d<17;d++){var c=document.createElement("option");c.text=d;c.value=d;e.add(c)}this.uicontainer.appendChild(b);this.uicontainer.appendChild(e);var a=this;e.addEventListener("change",function(){a.setoutmidichannel(parseInt(this.value))})}else{this.errornooutputdevice();return}};TBMWMIDIio.prototype.addtestbutton=function(){if(this.havemidi&&this.havemidiout){var b=document.createElement("button");b.setAttribute("id",this.testoutputbutton);b.innerHTML="Test MIDI Out";this.uicontainer.appendChild(b);var a=this;b.addEventListener("mousedown",function(){a.noteon(null,64,127,null)},false);b.addEventListener("mouseup",function(){a.noteoff(null,64,127,null)},false)}else{this.errornooutputdevice();return}};TBMWMIDIio.prototype.noteon=function(e,c,d,a){if(this.havemidi&&this.havemidiout){var b=(e)?e:this.midichannel;var f=(a)?this.time(a):this.time();this.midiout.send([this.channelmessage("noteon",b),c,d],f)}else{this.errornooutputdevice();return}};TBMWMIDIio.prototype.noteoff=function(e,c,d,a){if(this.havemidi&&this.havemidiout){var b=(e)?e:this.midichannel;var f=(a)?this.time(a):this.time();this.midiout.send([this.channelmessage("noteoff",b),c,d],f)}else{this.errornooutputdevice();return}};TBMWMIDIio.prototype.clocktick=function(){self.midiout.send([this.systemmessage("clock")],this.time())};TBMWMIDIio.prototype.clockstop=function(){self.midiout.send([this.systemmessage("stop")],this.time())};TBMWMIDIio.prototype.clockcontinue=function(){self.midiout.send([this.systemmessage("continue")],this.time())};