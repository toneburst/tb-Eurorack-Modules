function TBMWMIDIio(){this.uicontainer=null,this.containerclass="midiui",this.idprefix="tbwm-io",this.outputselectid=this.idprefix+"-outputdevice",this.channelselectid=this.idprefix+"-channel",this.testoutputbutton=this.idprefix+"-testoutput",this.havemidi=!1,this.havemidiin=!1,this.havemidiout=!1,this.havecontainer=!1,this.midiaccess={},this.outputs={},this.inputs={},this.midiout={},this.midiin={},this.midichannel=1}MicroEvent.mixin(TBMWMIDIio),TBMWMIDIio.prototype.setcookie=function(t,e,i){var o=new Date;o.setTime(o.getTime()+24*i*60*60*1e3);var n="expires="+o.toUTCString();document.cookie=t+"="+e+"; "+n},TBMWMIDIio.prototype.getcookie=function(t){for(var e=t+"=",i=document.cookie.split(";"),o=0;o<i.length;o++){for(var n=i[o];" "==n.charAt(0);)n=n.substring(1);if(0==n.indexOf(e))return n.substring(e.length,n.length)}return""},TBMWMIDIio.prototype.errordomelement=function(){var t="Error: Container element not found. You need to specify ID of an existing element (with or without leading '#') when initialising this instance or calling this method";return console.log(t),t},TBMWMIDIio.prototype.createlabel=function(t,e){var i=document.createElement("label");return i.setAttribute("for",t),i.innerHTML=e,i},TBMWMIDIio.prototype.errornomidi=function(t){this.havemidi=!1;var e=t;console.log(e)},TBMWMIDIio.prototype.errornooutputdevice=function(){this.havemidiout=!1;var t="Error: No MIDI output device is accessible.";console.log(t)},TBMWMIDIio.prototype.errornoinputdevice=function(){this.havemidi=!1;var t="Error: No MIDI input device is accessible.";console.log(t)},TBMWMIDIio.prototype.channelmessage=function(t,e){var i={noteoff:8,noteon:9,controlchange:11,channelmode:11,programchange:12,channelaftertouch:13,pitchbend:14};return i[t]?(i[t]<<4)+(e-1):void console.log("Error: MIDI Channel message not found")},TBMWMIDIio.prototype.systemmessage=function(t){var e={sysex:240,timecode:241,songposition:242,songselect:243,tuningrequest:246,sysexend:247,clock:248,start:250,"continue":251,stop:252,activesensing:254,reset:255};return e[t]?(e[t]<<4)+(ch-1):void console.log("Error: MIDI System message not found")},TBMWMIDIio.prototype.time=function(t){var e=window.performance.now();return t?e+t:e},TBMWMIDIio.prototype.init=function(t){function e(t){o.havemidi=!0,o.midiaccess=t,o.outputs=o.midiaccess.outputs,o.outputs.size>0?(o.midiout=o.outputs.values().next().value,o.midiout.open(),o.havemidiout=!0):(o.errornooutputdevice(),o.havemidiout=!1),console.log("MIDI system success!"),o.trigger("midistatus","success")}function i(t){o.havemidi=!1,o.havemidiin=!1,o.havemidiout=!1,console.log("Uh-oh! Something went wrong! Error code: "+t.code),o.trigger("midistatus","fail")}if(!t)return this.errordomelement();if(this.uicontainer=document.getElementById(t.replace("#","")),!this.uicontainer)return this.errordomelement();this.havecontainer=!0,this.uicontainer.classList.add(this.containerclass);var o=this;navigator.requestMIDIAccess().then(e,i)},TBMWMIDIio.prototype.setoutputdevice=function(t){if(!this.havemidiout)return void this.errornooutputdevice();var e=null;this.outputs.forEach(function(i){(i.id===t||i.name===t)&&(e||(e=i))}),e?(this.midiout.close(),this.midiout=e,this.midiout.open()):console.log("Error: MIDI output port not available")},TBMWMIDIio.prototype.addoutputselect=function(t){if(this.havemidi&&this.havemidiout){var e=null;t===!0&&(e=this.getcookie("midioutportname"),e&&this.setoutputdevice(e));var i=this.createlabel(this.outputselectid,"Select MIDI Output Device"),o=document.createElement("select");o.setAttribute("id",this.outputselectid),this.outputs.forEach(function(t){var i=document.createElement("option");i.text=t.name,e&&e===t.name&&i.setAttribute("selected","selected"),i.value=t.id,o.add(i)}),this.uicontainer.appendChild(i),this.uicontainer.appendChild(o);var n=this;o.addEventListener("change",function(){n.setoutputdevice(this.value),t===!0&&n.setcookie("midioutportname",o.options[o.selectedIndex].text,365)})}else this.errornooutputdevice()},TBMWMIDIio.prototype.setoutmidichannel=function(t){this.midichannel=parseInt(t)},TBMWMIDIio.prototype.addoutchannelselect=function(t){if(!this.havemidi||!this.havemidiout)return void this.errornooutputdevice();var e=null;t===!0&&(e=this.getcookie("midioutchannel"),e&&this.setoutmidichannel(e));var i=this.createlabel(this.channelselectid,"Select MIDI Channel"),o=document.createElement("select");o.setAttribute("id",this.channelselectid);for(var n=1;17>n;n++){var s=document.createElement("option");s.text=n,s.value=n,e&&parseInt(e)===n&&s.setAttribute("selected","selected"),o.add(s)}this.uicontainer.appendChild(i),this.uicontainer.appendChild(o);var r=this;o.addEventListener("change",function(){r.setoutmidichannel(parseInt(this.value)),t===!0&&r.setcookie("midioutchannel",o.options[o.selectedIndex].text,365)})},TBMWMIDIio.prototype.addtestbutton=function(){if(!this.havemidi||!this.havemidiout)return void this.errornooutputdevice();var t=document.createElement("button");t.setAttribute("id",this.testoutputbutton),t.innerHTML="Test MIDI Out",this.uicontainer.appendChild(t);var e=this;t.addEventListener("mousedown",function(){e.send_noteon(null,64,127,null)},!1),t.addEventListener("mouseup",function(){e.send_noteoff(null,64,127,null)},!1)},TBMWMIDIio.prototype.send_noteon=function(t,e,i,o){if(!this.havemidi||!this.havemidiout)return void this.errornooutputdevice();var n=t?t:this.midichannel,s=o?this.time(o):this.time();this.midiout.send([this.channelmessage("noteon",n),e,i],s)},TBMWMIDIio.prototype.send_noteoff=function(t,e,i,o){if(!this.havemidi||!this.havemidiout)return void this.errornooutputdevice();var n=t?t:this.midichannel,s=o?this.time(o):this.time();this.midiout.send([this.channelmessage("noteoff",n),e,i],s)},TBMWMIDIio.prototype.send_controller=function(t,e,i,o){if(!this.havemidi||!this.havemidiout)return void this.errornooutputdevice();var n=t?t:this.midichannel,s=o?this.time(o):this.time();self.midiout.send([this.channelmessage("controller",n),e,i],s)},TBMWMIDIio.prototype.send_clocktick=function(){return this.havemidi&&this.havemidiout?void self.midiout.send([this.systemmessage("clock")],this.time()):void this.errornooutputdevice()},TBMWMIDIio.prototype.send_clockstop=function(){return this.havemidi&&this.havemidiout?void self.midiout.send([this.systemmessage("stop")],this.time()):void this.errornooutputdevice()},TBMWMIDIio.prototype.send_clockcontinue=function(){return this.havemidi&&this.havemidiout?void self.midiout.send([this.systemmessage("continue")],this.time()):void this.errornooutputdevice()};