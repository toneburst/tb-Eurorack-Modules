function TBWMNotequantiser(e){this.mpscales=Array(),this.mpscales[0]={name:"Chromatic",notes:[0,1,2,3,4,5,6,7,8,9,10,11]},this.mpscales[1]={name:"Ionian",notes:[0,0,2,2,4,5,5,7,7,9,9,11]},this.mpscales[2]={name:"Dorian",notes:[0,0,2,3,3,5,5,7,7,10,10]},this.mpscales[3]={name:"Phrygian",notes:[0,1,1,3,3,5,5,7,8,8,10,10]},this.mpscales[4]={name:"Lydian",notes:[0,0,2,2,4,4,6,7,7,9,11]},this.mpscales[5]={name:"Mixolydian",notes:[0,0,2,2,4,5,5,7,7,9,10,10]},this.mpscales[6]={name:"Aeolian Minor",notes:[0,0,2,3,3,5,5,7,8,8,10,10]},this.mpscales[7]={name:"Locrian",notes:[0,1,1,3,3,5,6,6,8,8,10,10]},this.mpscales[8]={name:"Blues Major",notes:[0,0,3,3,4,4,7,7,7,9,10,10]},this.mpscales[9]={name:"Blues Minor",notes:[0,0,3,3,3,5,6,7,7,10,10,10]},this.mpscales[10]={name:"Pentatonic Major",notes:[0,0,2,2,4,4,7,7,7,9,9,9]},this.mpscales[11]={name:"Pentatonic Minor",notes:[0,0,3,3,3,5,5,7,7,10,10,10]},this.mpscales[12]={name:"Raga Bhiarav",notes:[0,1,1,4,4,5,5,7,8,8,11,11]},this.mpscales[13]={name:"Raga Shri",notes:[0,1,1,4,4,4,6,7,8,8,11,11]},this.mpscales[14]={name:"Raga Rupatavi",notes:[0,1,1,3,3,5,5,7,7,10,10,11]},this.mpscales[15]={name:"Raga Todi",notes:[0,1,1,3,3,6,6,7,8,8,11,11]},this.mpscales[16]={name:"Raga Kaafi",notes:[0,0,2,2,4,5,5,5,9,9,10,11]},this.mpscales[17]={name:"Raga Meg",notes:[0,0,2,2,5,5,5,7,7,9,9,9]},this.mpscales[18]={name:"Raga Malkauns",notes:[0,0,3,3,3,5,5,8,8,8,10,10]},this.mpscales[19]={name:"Raga Deepak",notes:[0,0,3,3,4,4,6,6,8,8,10,10]},this.mpscales[20]={name:"Folkish",notes:[0,1,1,3,4,5,5,7,8,8,10,10]},this.mpscales[21]={name:"Japanese",notes:[0,1,1,1,5,5,5,7,8,8,8,8]},this.mpscales[22]={name:"Gamelan",notes:[0,1,1,3,3,3,7,7,8,8,8,8]},this.mpscales[23]={name:"Whole Tones",notes:[0,0,2,2,4,4,6,6,8,8,10,10]},this.scaleindex=0,this.scale=this.mpscales[this.scaleindex].notes,this.transpose=0,this.shift=0,this.scalerandomise=0,this.idprefix="tbwm-nq",this.scalesselectid=this.idprefix+"-scale",this.transposerangeid=this.idprefix+"-transpose",this.randomrangeid=this.idprefix+"-random",e&&this.applysettings(e)}TBWMNotequantiser.prototype.getsettings=function(){return{scaleindex:this.scaleindex,transpose:this.transpose,shift:this.shift,scalerandomise:this.scalerandomise}},TBWMNotequantiser.prototype.applysettings=function(e){e?(e.scaleindex&&(this.scaleindex=e.scaleindex),e.transpose&&(this.transpose=e.transpose),e.shift&&(this.shift=e.shift),e.scalerandomise&&(this.scalerandomise=e.scalerandomise)):console.log("Error: You need to pass in a settings object {scaleindex:[val],transpose:[val],shift:[val],scalerandomise:[val]}")},TBWMNotequantiser.prototype.checkdomelement=function(e){if(e){var t=document.getElementById(e.replace("#",""));return t?t:(this.errordomelement(),"error")}return this.errordomelement(),"error"},TBWMNotequantiser.prototype.errordomelement=function(){console.log("Error: Container element not found. You need to specify ID of an existing element (with or without leading '#') when initialising this instance or calling this method")},TBWMNotequantiser.prototype.setscale=function(e){this.scaleindex=Math.min(this.mpscales.length-1,e),this.scale=this.mpscales[this.scaleindex].notes},TBWMNotequantiser.prototype.addscaleselect=function(e){var t=this.checkdomelement(e);if("error"!==t){var s=document.createElement("label");s.setAttribute("for",this.scalesselectid),s.innerHTML="Select Scale";var a=document.createElement("select");a.setAttribute("id",this.scalesselectid);for(var n=0;n<this.mpscales.length;n++){var i=document.createElement("option");i.text=this.mpscales[n].name,i.value=n,a.add(i)}t.appendChild(s),t.appendChild(a);var o=this;a.addEventListener("change",function(){o.setscale(parseInt(this.value))})}},TBWMNotequantiser.prototype.settranspose=function(e){this.transpose=parseInt(e)},TBWMNotequantiser.prototype.addtransposeselect=function(e){var t=this.checkdomelement(e);if("error"!==t){var s=document.createElement("label");s.setAttribute("for",this.transposerangeid),s.innerHTML="Select Transpose";var a=document.createElement("input");a.setAttribute("id",this.transposerangeid),a.setAttribute("type","range"),a.setAttribute("min",-12),a.setAttribute("max",12),a.setAttribute("step",1),a.setAttribute("value",0),t.appendChild(s),t.appendChild(a);var n=this;a.addEventListener("change",function(){n.settranspose(parseInt(this.value))})}},TBWMNotequantiser.prototype.setshift=function(e){this.shift=Math.max(e,0)%11},TBWMNotequantiser.prototype.setrandomise=function(e){this.scalerandomise=e},TBWMNotequantiser.prototype.addrandomrange=function(e){var t=this.checkdomelement(e);if("error"!==t){var s=document.createElement("label");s.setAttribute("for","random"),s.innerHTML="Scale Randomise";var a=document.createElement("input");a.setAttribute("type","range"),a.setAttribute("min",0),a.setAttribute("max",1),a.setAttribute("step",.01),a.setAttribute("value",0),a.setAttribute("id","random"),t.appendChild(s),t.appendChild(a);var n=this;a.addEventListener("change",function(){n.setrandomise(parseFloat(this.value))})}},TBWMNotequantiser.prototype.applyscale=function(e){var t=Math.floor(e/12),s=(e+this.shift)%12;return this.scalerandomise>0&&Math.random()<=this.scalerandomise&&(s=Math.round(11*Math.random())),Math.max(Math.min(12*t+this.scale[s]+this.transpose,127),0)},TBWMNotequantiser.prototype.getscales=function(){return this.mpscales},TBWMNotequantiser.prototype.logscales=function(){for(var e=0;e<this.mpscales.length;e++)console.log(e+": "+this.mpscales[e].name)},TBWMNotequantiser.prototype.getscaleinfo=function(){return{index:this.scaleindex,name:this.mpscales[this.scaleindex].name,scale:this.scale}},TBWMNotequantiser.prototype.logscaleinfo=function(){console.log({index:this.scaleindex,name:this.mpscales[this.scaleindex].name,scale:this.scale})};