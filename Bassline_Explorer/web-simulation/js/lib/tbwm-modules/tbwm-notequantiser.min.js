function TBWMNotequantiser(a){this.mpscales=Array();this.mpscales[0]={name:"Chromatic",notes:[0,1,2,3,4,5,6,7,8,9,10,11]};this.mpscales[1]={name:"Ionian",notes:[0,0,2,2,4,5,5,7,7,9,9,11]};this.mpscales[2]={name:"Dorian",notes:[0,0,2,3,3,5,5,7,7,10,10]};this.mpscales[3]={name:"Phrygian",notes:[0,1,1,3,3,5,5,7,8,8,10,10]};this.mpscales[4]={name:"Lydian",notes:[0,0,2,2,4,4,6,7,7,9,11]};this.mpscales[5]={name:"Mixolydian",notes:[0,0,2,2,4,5,5,7,7,9,10,10]};this.mpscales[6]={name:"Aeolian Minor",notes:[0,0,2,3,3,5,5,7,8,8,10,10]};this.mpscales[7]={name:"Locrian",notes:[0,1,1,3,3,5,6,6,8,8,10,10]};this.mpscales[8]={name:"Blues Major",notes:[0,0,3,3,4,4,7,7,7,9,10,10]};this.mpscales[9]={name:"Blues Minor",notes:[0,0,3,3,3,5,6,7,7,10,10,10]};this.mpscales[10]={name:"Pentatonic Major",notes:[0,0,2,2,4,4,7,7,7,9,9,9]};this.mpscales[11]={name:"Pentatonic Minor",notes:[0,0,3,3,3,5,5,7,7,10,10,10]};this.mpscales[12]={name:"Raga Bhiarav",notes:[0,1,1,4,4,5,5,7,8,8,11,11]};this.mpscales[13]={name:"Raga Shri",notes:[0,1,1,4,4,4,6,7,8,8,11,11]};this.mpscales[14]={name:"Raga Rupatavi",notes:[0,1,1,3,3,5,5,7,7,10,10,11]};this.mpscales[15]={name:"Raga Todi",notes:[0,1,1,3,3,6,6,7,8,8,11,11]};this.mpscales[16]={name:"Raga Kaafi",notes:[0,0,2,2,4,5,5,5,9,9,10,11]};this.mpscales[17]={name:"Raga Meg",notes:[0,0,2,2,5,5,5,7,7,9,9,9]};this.mpscales[18]={name:"Raga Malkauns",notes:[0,0,3,3,3,5,5,8,8,8,10,10]};this.mpscales[19]={name:"Raga Deepak",notes:[0,0,3,3,4,4,6,6,8,8,10,10]};this.mpscales[20]={name:"Folkish",notes:[0,1,1,3,4,5,5,7,8,8,10,10]};this.mpscales[21]={name:"Japanese",notes:[0,1,1,1,5,5,5,7,8,8,8,8]};this.mpscales[22]={name:"Gamelan",notes:[0,1,1,3,3,3,7,7,8,8,8,8]};this.mpscales[23]={name:"Whole Tones",notes:[0,0,2,2,4,4,6,6,8,8,10,10]};this.scaleindex=0;this.scale=this.mpscales[this.scaleindex]["notes"];this.transpose=0;this.shift=0;this.scalerandomise=0;this.idprefix="tbwm-ui";this.scalesselectid=this.idprefix+"-scale";this.transposerangeid=this.idprefix+"-transpose";this.randomiserangeid=this.idprefix+"-random";this.containerclass=this.idprefix;if(a){this.applysettings(a)}}TBWMNotequantiser.prototype.getsettings=function(){return{scaleindex:this.scaleindex,transpose:this.transpose,shift:this.shift,scalerandomise:this.scalerandomise}};TBWMNotequantiser.prototype.applysettings=function(a){if(a){if(a.scaleindex){this.scaleindex=a.scaleindex}if(a.transpose){this.transpose=a.transpose}if(a.shift){this.shift=a.shift}if(a.scalerandomise){this.scalerandomise=a.scalerandomise}}else{console.log("Error: You need to pass in a settings object {scaleindex:[val],transpose:[val],shift:[val],scalerandomise:[val]}")}};TBWMNotequantiser.prototype.checkdomelement=function(a){if(a){var b=document.getElementById(a.replace("#",""));if(!b){this.errordomelement(a);return null}else{return b}}else{this.errordomelement();return null}};TBWMNotequantiser.prototype.errordomelement=function(a){var b=(a)?"'"+a+"'":"";var c="Error: Container element "+b+" not found. You need to specify ID of an existing element (with or without leading '#') when calling this method";console.log(c);return c};TBWMNotequantiser.prototype.setscale=function(a){this.scaleindex=Math.min(this.mpscales.length-1,a);this.scale=this.mpscales[this.scaleindex]["notes"]};TBWMNotequantiser.prototype.addscaleselect=function(f){var b=this.checkdomelement(f.domcontainer);if(!b){return this}if(f.addlabel===true){var c=document.createElement("label");c.setAttribute("for",this.outputselectid);c.innerHTML=(f.labeltext!==undefined)?f.labeltext:"Select Scale";c.setAttribute("class",this.containerclass);b.appendChild(c)}var g=document.createElement("select");g.setAttribute("id",this.scalesselectid);for(var e=0;e<this.mpscales.length;e++){var d=document.createElement("option");d.text=this.mpscales[e]["name"];d.value=e;g.add(d)}b.appendChild(g);var a=this;g.addEventListener("change",function(){a.setscale(parseInt(this.value))})};TBWMNotequantiser.prototype.settranspose=function(a){this.transpose=parseInt(a)};TBWMNotequantiser.prototype.addtransposeselect=function(e){var c=this.checkdomelement(e.domcontainer);if(!c){return this}if(e.addlabel===true){var d=document.createElement("label");d.setAttribute("for",this.transposerangeid);d.innerHTML=(e.labeltext!==undefined)?e.labeltext:"Transpose Amount";d.setAttribute("class",this.containerclass);c.appendChild(d)}var b=document.createElement("input");b.setAttribute("id",this.transposerangeid);b.setAttribute("type","range");b.setAttribute("min",-12);b.setAttribute("max",12);b.setAttribute("step",1);b.setAttribute("value",0);c.appendChild(b);var a=this;b.addEventListener("change",function(){a.settranspose(parseInt(this.value))})};TBWMNotequantiser.prototype.setshift=function(a){this.shift=Math.max(a,0)%11};TBWMNotequantiser.prototype.setrandomise=function(a){this.scalerandomise=a};TBWMNotequantiser.prototype.addrandomrange=function(e){var c=this.checkdomelement(e.domcontainer);if(!c){return this}if(e.addlabel===true){var d=document.createElement("label");d.setAttribute("for",this.randomiserangeid);d.innerHTML=(e.labeltext!==undefined)?e.labeltext:"Scale Randomise Amount";d.setAttribute("class",this.containerclass);c.appendChild(d)}var b=document.createElement("input");b.setAttribute("type","range");b.setAttribute("min",0);b.setAttribute("max",1);b.setAttribute("step",0.01);b.setAttribute("value",0);b.setAttribute("id",this.randomiserangeid);c.appendChild(b);var a=this;b.addEventListener("change",function(){a.setrandomise(parseFloat(this.value))})};TBWMNotequantiser.prototype.applyscale=function(c){var a=Math.floor(c/12);var b=(c+this.shift)%12;if((this.scalerandomise>0)&&(Math.random()<=this.scalerandomise)){b=Math.round(Math.random()*11)}return Math.max(Math.min(12*a+this.scale[b]+this.transpose,127),0)};TBWMNotequantiser.prototype.getscales=function(){return this.mpscales};TBWMNotequantiser.prototype.logscales=function(){for(var a=0;a<this.mpscales.length;a++){console.log(a+": "+this.mpscales[a]["name"])}};TBWMNotequantiser.prototype.getscaleinfo=function(){return{index:this.scaleindex,name:this.mpscales[this.scaleindex]["name"],scale:this.scale}};TBWMNotequantiser.prototype.logscaleinfo=function(){console.log({index:this.scaleindex,name:this.mpscales[this.scaleindex]["name"],scale:this.scale})};