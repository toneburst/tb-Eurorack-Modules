function getrandom(e,t){return Math.round(Math.random()*e)+t}function U8Mix(e,t,n){return 255==n?t:n*t+(255-n)*e>>8}function U8Switch(e,t,n){return n>>7==0?e:t}function getcorners(e,t,n,o,i){var r=[coordtable[t][0],coordtable[n][0]],s=e[r[1]][r[0]][o][i],a=e[r[1]][r[0]+1][o][i],l=e[r[1]+1][r[0]][o][i],c=e[r[1]+1][r[0]+1][o][i];return[s,a,l,c]}function bilinear(e,t,n,o,i){var r=getcorners(e,n,o,t,i),s=[coordtable[n][1],coordtable[o][1]];return U8Mix(U8Mix(r[0],r[1],s[0]),U8Mix(r[2],r[3],s[0]),s[1])}function cornerswitch(e,t,n,o,i){var r=(channelstepcount[t][1],getcorners(e,n,o,t,i)),s=[coordtable[n][1],coordtable[o][1]];return U8Switch(U8Switch(r[0],r[1],s[0]),U8Switch(r[2],r[3],s[0]),s[1])}function playStep(){var e=stepvals[0],t=stepvals[1],n=thresholds[0],o=stepvals[2],r=stepvals[3],s=(thresholds[1],stepvals[4]),a=thresholds[2];stepvals[5],thresholds[3];if(128>n)t>n&&(e=0),r>n&&(o=1);else if(n>127){var l=n-127,c=channelstepcount[0][2]+randomtablecounter;l>120&&(c=randomtablecounter+randomtablerandomoffset),c%=noterandomtable.length,l>r&&(e=(e+noterandomtable[c])%11),l>t&&(o=(o+octaverandomtable[c])%2)}midi_notenum=scale[e]+12*o+transpose;var u=a>s?midi_highvelocity:midi_lowvelocity,d=slide&&midi_notenum==midi_previousnotes[midi_previousnotes.length-1]?!0:!1;for(d||Jazz.MidiOut(144,midi_notenum,u),midi_previousnotes.push(midi_notenum),masterstepcounter++,i=0;i<channelstepcount.length;i++){var h=channelstepcount[i][0],p=channelstepcount[i][1];channelstepcount[i][2]=(masterstepcounter+p)%h}masterstepcounter%channelstepcount[0][0]==0&&(randomtablecounter=randomtablecounter<channelstepcount[0][0]?randomtablecounter+1:0,randomtablerandomoffset=getrandom(noterandomtable.length-1,0))}function getStepVals(){var e=[0,0,1,1,2,3];for(i=0;i<stepvals.length;i++){var t=e[i];2==i?stepvals[i]=cornerswitch(patterns,i,valx,valy,channelstepcount[t][2]):stepvals[i]=bilinear(patterns,i,valx,valy,channelstepcount[t][2])}if(slide=stepvals[5]<thresholds[3]?!0:!1,slide);else{for(i=0;i<midi_previousnotes.length;i++)Jazz.MidiOut(128,midi_previousnotes[i],0);midi_previousnotes=[]}thresholds[3]<32&&(notelength=notelengthtable[thresholds[3]],halfstep=notelength*stepperiod)}function sequencer(){setInterval(function(){playStep(),setTimeout(function(){getStepVals()},halfstep)},stepperiod)}