function getrandom(e,t){return Math.round(Math.random()*e)+t}function U8Mix(e,t,n){return 255==n?t:n*t+(255-n)*e>>8}function U8Switch(e,t,n){return n>>7==0?e:t}function getcorners(e,t,n,o,a){var i=[coordtable[t][0],coordtable[n][0]],r=e[i[1]][i[0]][o][a],s=e[i[1]][i[0]+1][o][a],l=e[i[1]+1][i[0]][o][a],c=e[i[1]+1][i[0]+1][o][a];return[r,s,l,c]}function bilinear(e,t,n,o,a){var i=getcorners(e,n,o,t,a),r=[coordtable[n][1],coordtable[o][1]];return U8Mix(U8Mix(i[0],i[1],r[0]),U8Mix(i[2],i[3],r[0]),r[1])}function cornerswitch(e,t,n,o,a){var i=(channelstepcount[t][1],getcorners(e,n,o,t,a)),r=[coordtable[n][1],coordtable[o][1]];return U8Switch(U8Switch(i[0],i[1],r[0]),U8Switch(i[2],i[3],r[0]),r[1])}function playStep(){var e=stepvals[0],t=stepvals[1],n=thresholds[0],o=stepvals[2],a=stepvals[3],r=thresholds[1],s=stepvals[4],l=thresholds[2];stepvals[5],thresholds[3];if(127>n)t>n&&(e=0);else if(n>=127&&n-127>t){var c=channelstepcount[0][2]+randomtablecounter;250>n&&(c+=randomtablerandomoffset),c%=noterandomtable.length-1,e=(e+noterandomtable[c])%11}if(127>r)a>r&&(o=1);else if(r>=127&&r-127>a){var c=channelstepcount[1][2]+randomtablecounter;250>r&&(c+=randomtablerandomoffset),c%=octaverandomtable.length-1,o=(o+octaverandomtable[c])%2}midi_notenum=scale[e]+12*o+transpose;var d=midi_lowvelocity;if(l>s&&(d=midi_highvelocity),l>=192&&l-192>s>>2){var c=channelstepcount[2][2]+randomtablecounter;l>250&&(c+=randomtablerandomoffset),c%=accentrandomtable.length-1,0===accentrandomtable[c]&&(d=midi_lowvelocity)}var u=slide&&midi_notenum==midi_previousnotes[midi_previousnotes.length-1]?!0:!1;for(u||Jazz.MidiOut(144,midi_notenum,d),midi_previousnotes.push(midi_notenum),i=0;i<channelstepcount.length;i++){var m=channelstepcount[i][0],h=channelstepcount[i][1];channelstepcount[i][2]=(masterstepcounter+h)%m}masterstepcounter%channelstepcount[0][0]==0&&(randomtablecounter=randomtablecounter<channelstepcount[0][0]-1?randomtablecounter+1:0,randomtablerandomoffset=getrandom(noterandomtable.length-1,0))}function getStepVals(){var e=[0,0,1,1,2,3];for(i=0;i<stepvals.length;i++){var t=e[i];2==i?stepvals[i]=cornerswitch(patterns,i,valx,valy,channelstepcount[t][2]):stepvals[i]=bilinear(patterns,i,valx,valy,channelstepcount[t][2])}if(slide=stepvals[5]<easeinsine256[thresholds[3]]?!0:!1,slide)midi_previousnotes.length>2&&Jazz.MidiOut(128,midi_previousnotes.shift());else{for(i=0;i<midi_previousnotes.length;i++)Jazz.MidiOut(128,midi_previousnotes[i],0);midi_previousnotes=[]}}