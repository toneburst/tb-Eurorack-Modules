function getrandom(a,b){return Math.round(Math.random()*a)+b}function U8Mix(e,d,c){return(c==255)?d:c*d+(255-c)*e>>8}function U8Switch(e,d,c){return(c>>7==0)?e:d}function getcorners(g,n,k,e,o){var f=[coordtable[n][0],coordtable[k][0]];var m=g[f[1]][f[0]][e][o];var l=g[f[1]][f[0]+1][e][o];var j=g[f[1]+1][f[0]][e][o];var h=g[f[1]+1][f[0]+1][e][o];return[m,l,j,h]}function bilinear(d,e,b,g,a){var c=getcorners(d,b,g,e,a);var f=[coordtable[b][1],coordtable[g][1]];return U8Mix(U8Mix(c[0],c[1],f[0]),U8Mix(c[2],c[3],f[0]),f[1])}function cornerswitch(d,e,b,h,a){var f=channelstepcount[e][1];var c=getcorners(d,b,h,e,a);var g=[coordtable[b][1],coordtable[h][1]];return U8Switch(U8Switch(c[0],c[1],g[0]),U8Switch(c[2],c[3],g[0]),g[1])}function playStep(){var j=stepvals[0];var q=stepvals[1];var f=thresholds[0];var n=stepvals[2];var h=stepvals[3];var l=thresholds[1];var b=stepvals[4];var k=thresholds[2];var o=stepvals[5];var p=thresholds[3];if(f<128){if(q>f){j=0}if(h>f){n=1}}else{if(f>127){var e=f-127;var d=(channelstepcount[0][2]+randomtablecounter);if(e>120){d=randomtablecounter+randomtablerandomoffset}d=d%noterandomtable.length;if(h<e){j=(j+noterandomtable[d])%11}if(q<e){n=(n+octaverandomtable[d])%2}}}midi_notenum=scale[j]+(12*n)+transpose;var m=(b<easeinsine256[k])?midi_highvelocity:midi_lowvelocity;var a=(slide&&midi_notenum==midi_previousnotes[midi_previousnotes.length-1])?true:false;if(!a){Jazz.MidiOut(144,midi_notenum,m)}midi_previousnotes.push(midi_notenum);masterstepcounter++;for(i=0;i<channelstepcount.length;i++){var c=channelstepcount[i][0];var g=channelstepcount[i][1];channelstepcount[i][2]=(masterstepcounter+g)%c}if(masterstepcounter%channelstepcount[0][0]==0){randomtablecounter=(randomtablecounter<channelstepcount[0][0])?randomtablecounter+1:0;randomtablerandomoffset=getrandom(noterandomtable.length-1,0)}}function getStepVals(){var b=[0,0,1,1,2,3];for(i=0;i<stepvals.length;i++){var a=b[i];if(i==2){stepvals[i]=cornerswitch(patterns,i,valx,valy,channelstepcount[a][2])}else{stepvals[i]=bilinear(patterns,i,valx,valy,channelstepcount[a][2])}}slide=(stepvals[5]<easeinsine256[thresholds[3]])?true:false;if(slide){if(midi_previousnotes.length>2){Jazz.MidiOut(128,midi_previousnotes.shift())}}else{for(i=0;i<midi_previousnotes.length;i++){Jazz.MidiOut(128,midi_previousnotes[i],0)}midi_previousnotes=[]}if(thresholds[3]<32){console.log(notelengthtable[thresholds[3]]);clock.setGateLength(notelengthtable[thresholds[3]])}else{clock.setGateLength(0.5)}};